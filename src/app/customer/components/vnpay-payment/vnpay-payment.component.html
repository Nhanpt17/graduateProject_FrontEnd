<div class="vnpay-dialog-container">
    <h2 mat-dialog-title class="dialog-title-custom">
        <mat-icon>account_balance</mat-icon>
        &nbsp;
        <span class="">Thanh to√°n qua VNPAY</span>
    </h2>

    <mat-divider></mat-divider>

    <mat-dialog-content class="mat-typography dialog-content-custom">
        <form [formGroup]="vnpayForm" (ngSubmit)="submitVnpayPayment()" class="vnpay-form">

            <h3 class="section-title">1. Th√¥ng tin giao h√†ng</h3>

            <mat-form-field appearance="fill" class="w-full">
                <mat-label>S·ªë ƒëi·ªán tho·∫°i</mat-label>
                <input matInput placeholder="VD: 0901234567" formControlName="phone" required>
                <mat-error *ngIf="vnpayForm.get('phone')?.invalid && vnpayForm.get('phone')?.touched">
                    Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
                <mat-label>ƒê·ªãa ch·ªâ giao h√†ng</mat-label>
                 <!-- ƒê·ªîI t·ª´ textarea ‚Üí input v√† TH√äM [matAutocomplete] -->
                <input 
                    matInput 
                    placeholder="VD: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1" 
                    formControlName="address"
                    [matAutocomplete]="auto"
                    required>
                <!-- Loading spinner (hi·ªán khi ƒëang g·ªçi API) -->
                <mat-icon matSuffix *ngIf="isLoadingAddress">
                    <mat-spinner diameter="20"></mat-spinner>
                </mat-icon>
                
                <mat-error *ngIf="vnpayForm.get('address')?.invalid && vnpayForm.get('address')?.touched">
                    Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ
                </mat-error>
            </mat-form-field>
            
            <!-- ========== DROPDOWN AUTOCOMPLETE ========== -->
            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectAddress($event.option.value)">
                <!-- L·∫∑p qua danh s√°ch g·ª£i √Ω -->
                <mat-option *ngFor="let prediction of predictions" [value]="prediction">
                    <div class="address-option">
                        <!-- Icon ƒë·ªãa ƒëi·ªÉm -->
                        <mat-icon class="location-icon">location_on</mat-icon>
                        
                        <!-- Text ƒë·ªãa ch·ªâ -->
                        <div class="address-text">
                            <div class="main-text">{{ prediction.structured_formatting?.main_text }}</div>
                            <div class="secondary-text">{{ prediction.structured_formatting?.secondary_text }}</div>
                        </div>
                    </div>
                </mat-option>
            </mat-autocomplete>

            <h3 class="section-title">2. Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</h3>
            <mat-radio-group formControlName="bankCode" class="radio-group payment-method-group">
                <mat-radio-button value="default" class="radio-item">
                    <span class="icon-method">
                        <mat-icon color="accent" class="radio-icon">open_in_new</mat-icon>
                        <span>Chuy·ªÉn h∆∞·ªõng sang VNPAY (Khuy·∫øn ngh·ªã) </span>
                    </span>

                </mat-radio-button>

                <mat-radio-button value="VNPAYQR" class="radio-item">
                    <span class="icon-method">
                        <mat-icon color="accent" class="radio-icon">qr_code_2</mat-icon>
                        <span>·ª®ng d·ª•ng h·ªó tr·ª£ VNPAYQR</span>
                    </span>


                </mat-radio-button>

                <mat-radio-button value="VNBANK" class="radio-item">
                    <span class="icon-method">
                        <mat-icon color="accent" class="radio-icon">credit_card</mat-icon>
                        <span>Th·∫ª ATM / T√†i kho·∫£n n·ªôi ƒë·ªãa</span>
                    </span>


                </mat-radio-button>

                <mat-radio-button value="INTCARD" class="radio-item">

                    <span class="icon-method">
                        <mat-icon color="accent" class="radio-icon">language</mat-icon>
                        <span>Th·∫ª qu·ªëc t·∫ø (Visa / MasterCard)</span>
                    </span>

                </mat-radio-button>
            </mat-radio-group>


            <h3 class="section-title">3. Ch·ªçn ng√¥n ng·ªØ</h3>
            <mat-radio-group formControlName="language" class="language-group">
                <mat-radio-button value="vn" class="radio-item">
                    <span class="flag-icon">üáªüá≥</span> Ti·∫øng Vi·ªát
                </mat-radio-button>
                <mat-radio-button value="en" class="radio-item">
                    <span class="flag-icon">üá¨üáß</span> English
                </mat-radio-button>
            </mat-radio-group>

        </form>
    </mat-dialog-content>

    <mat-dialog-actions class="dialog-actions-custom">
  <div class="left-actions">
    <button mat-button [mat-dialog-close]="false" color="accent" class="cancel-btn">
      <mat-icon>close</mat-icon> ƒê√≥ng
    </button>
  </div>

  <div class="right-actions">
    <button mat-raised-button color="primary" type="submit"
            [disabled]="loading || totalPrice <= 0"
            (click)="submitVnpayPayment()" class="pay-btn">
      <mat-icon>credit_card</mat-icon>
      <span *ngIf="!loading">Thanh to√°n VNPAY</span>
      <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
    </button>
  </div>
</mat-dialog-actions>


</div>